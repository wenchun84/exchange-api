<!doctype html>
<html lang="zh-Hant">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>æœ¬æ—¥å³æ™‚åŒ¯ç‡è¡¨</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container py-4" style="max-width:620px">
  <h3 class="text-center mb-4">ğŸŒ æœ¬æ—¥å³æ™‚åŒ¯ç‡è¡¨</h3>

  <div class="mb-3">
    <label class="form-label">åŸºæº–è²¨å¹£</label>
    <select id="base" class="form-select" style="max-width:180px">
      <option>USD</option><option>TWD</option><option>JPY</option>
      <option>EUR</option><option>CNY</option><option>HKD</option>
      <option>GBP</option><option>AUD</option><option>SGD</option>
      <option>KRW</option>
    </select>
  </div>

  <table class="table table-striped align-middle">
    <thead class="table-light">
      <tr><th>è²¨å¹£</th><th class="text-end">1&nbsp;<span id="baseLabel">USD</span> å¯æ›</th></tr>
    </thead>
    <tbody id="tbody"><tr><td colspan="2">è¼‰å…¥ä¸­â€¦</td></tr></tbody>
  </table>
  <p class="text-end text-muted" style="font-size:smaller" id="ts"></p>
</div>

<script>
const API = "/convert";                                   // âœ” åŒä¸€ä¸»æ©Ÿç›¸å°è·¯å¾‘
const symbols = ["USD","TWD","JPY","EUR","CNY","HKD","GBP","AUD","SGD","KRW"];

const baseSel = base, tbody = document.getElementById('tbody'), baseLabel = baseLabel;

baseSel.addEventListener("change", loadRates);
loadRates();                                              // é¦–æ¬¡è¼‰å…¥

async function loadRates(){
  const b = baseSel.value;
  baseLabel.textContent = b;
  tbody.innerHTML = '<tr><td colspan="2">è¼‰å…¥ä¸­â€¦</td></tr>';
  const rows = [];

  for(const s of symbols){
    if(s === b) continue;
    try{
      const url=`${API}?from=${b}&to=${s}&amount=1`;
      const r = await fetch(url).then(r=>r.json());
      if(r.result === undefined) throw r;
      rows.push(`<tr><td>${s}</td><td class="text-end">${r.result.toFixed(4)} ${s}</td></tr>`);
    }catch(e){
      rows.push(`<tr><td>${s}</td><td class="text-end text-warning">éŒ¯èª¤</td></tr>`);
      console.error("convert error", s, e);
    }
  }

  tbody.innerHTML = rows.join("");
  document.getElementById('ts').textContent = "æ›´æ–°æ™‚é–“ï¼š" + new Date().toLocaleString();
}
</script>
