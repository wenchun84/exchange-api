<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>本日即時匯率表</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-4" style="max-width:620px">
  <h3 class="text-center mb-4">🌐 本日即時匯率表</h3>

  <div class="mb-3">
    <label class="form-label">基準貨幣</label>
    <select id="base" class="form-select" style="max-width:180px">
      <option>USD</option><option>TWD</option><option>JPY</option>
      <option>EUR</option><option>CNY</option><option>HKD</option>
      <option>GBP</option><option>AUD</option><option>SGD</option>
      <option>KRW</option>
    </select>
  </div>

  <table class="table table-striped align-middle">
    <thead class="table-light">
      <tr><th>貨幣</th><th class="text-end">1&nbsp;<span id="baseLabel">USD</span> 可換</th></tr>
    </thead>
    <tbody id="tbody"><tr><td colspan="2">載入中…</td></tr></tbody>
  </table>
  <p class="text-end text-muted" style="font-size:smaller" id="ts"></p>
</div>

<script>
const API = "/latest";              // ← 同源呼叫 /latest
const symbols = ["USD","TWD","JPY","EUR","CNY","HKD","GBP","AUD","SGD","KRW"];

const baseSel = document.getElementById('base'),
      tbody   = document.getElementById('tbody'),
      baseLbl = document.getElementById('baseLabel'),
      ts      = document.getElementById('ts');

baseSel.addEventListener("change", loadRates);
loadRates();

async function loadRates(){
  const base = baseSel.value;
  baseLbl.textContent = base;
  tbody.innerHTML = '<tr><td colspan="2">載入中…</td></tr>';

  try {
    // 呼叫後端 /latest
    const url = `${API}?base=${base}&symbols=${symbols.filter(s=>s!==base).join(",")}`;
    const data = await fetch(url).then(r=>r.json());
    if (!data.success) throw new Error(data.error?.info||"No data");

    const rows = Object.entries(data.rates)
      .map(([k,v])=>`<tr><td>${k}</td><td class="text-end">${v.toFixed(4)} ${k}</td></tr>`)
      .join("");
    tbody.innerHTML = rows;

  } catch(e) {
    console.error(e);
    tbody.innerHTML = '<tr><td colspan="2" class="text-warning">服務暫時不可用</td></tr>';
  }

  ts.textContent = "更新時間：" + new Date().toLocaleString();
}
</script>
</body>
</html>
